<!doctype html>
<html lang="ko">
  <head>
    <!-- @include partials/head-shared.html -->
    <title>[Java] DataSource — {{SITE_NAME}}</title>
    <meta name="description" content="{{PAGE_DESCRIPTION}}" />
    <link rel="canonical" href="{{PAGE_URL}}" />
    <meta property="og:title" content="[Java] DataSource — {{SITE_NAME}}" />
    <meta property="og:description" content="{{PAGE_DESCRIPTION}}" />
    <meta property="og:type" content="article" />
    <meta property="og:url" content="{{PAGE_URL}}" />
    <meta property="og:image" content="{{OG_IMAGE}}" />
    <meta name="twitter:card" content="summary_large_image" />
    <link rel="alternate" type="application/rss+xml" title="{{SITE_NAME}}" href="/feed.xml" />
  </head>
  <body>
    <a class="u-sr-only u-sr-only--focusable" href="#main">본문 바로가기</a>
    <!-- @include partials/site-header.html -->

    <main id="main" class="l-reading" role="main">
      <article class="c-article u-flow" aria-labelledby="post-title">
        <header>
          <h1 id="post-title">[Java] DataSource</h1>
          <p class="c-article__meta">2025-07-23</p>
        </header>
        <h1>정의</h1>
<p>--- Java에서 데이터베이스와 연결하기 위한 인터페이스 역할로 JDBC 커넥션을 생성하고 관리하기 위해 사용</p>
<h2>기능 및 설명</h2>
<p>| 기능         | 설명                                            | | ---------- | --------------------------------------------- | | 커넥션 풀 관리   | 커넥션 객체를 재사용하여 성능 향상                           | | 트랜잭션 관리 연동 | Spring의 트랜잭션 관리자와 연동                          | | 외부 설정 연동   | DB 정보(url/usernamepaassword)를 분리하여 설정 가능      | | 커넥션 제공     | Connection conn = dataSource.getConnection(); | > <strong>Spring에서는 javax.sql.DataSource 인터페이스를 구현한 다양한 커넥션 풀 라이브러리(HikariCP, DBCP 등)을 지원한다.</strong></p>
<h3>1. 커넥션 풀 관리</h3>
<ul>
  <li>데이터베이스와의 연결을 미리 생성해놓은 커넥션 풀을 관리</li>
  <li>App이 DB 접근시 새로운 연결 대신 풀에서 연결 재사용</li>
</ul>
<h3>2. 커넥션 획득 및 반납 추상화</h3>
<ul>
  <li><code>Connection getConnection()</code>을 이용하여 커넥션을 쉽게 생성, 사용 후 반납도 편리</li>
  <li>해당 과정이 추상화 되어, 실제 사용자는 신경 쓸 필요가 없음</li>
  <li>추상화 하여 DB 연결 방식의 변경에도 구현체만 변경하면 되어 유연성을 제공함</li>
</ul>
<h3>3. OCP(개방 폐쇄 원칙) 준수</h3>
<ul>
  <li>DB 종류나 환경이 달라져도 일관된 방식으로 DB 접근 가능</li>
  <li>이는 OCP에 부합함</li>
</ul>
<h3>4. JNDI 연동</h3>
<ul>
  <li>JNDI를 통해 등록 및 조회 하여 다양한 애플리케이션이 동일한 커넥션 풀을 공유할 수 있음</li>
</ul>
<h3>5. Spring에서 트랜잭션 관리자(PlatformTransactionManager)와 연동</h3>
<p>> 해당 과정은 <strong>Spring의 트랜잭션 관리자가 DataSource를 통하여 커넥션을 획득 관리</strong>함을 알 수 있게한다.</p>
<ul>
  <li>JDBC환경에서 주로 사용되는 <code>DataSourceTransactionManager</code>의 생성 시 DataSource를 주입받아 트랜잭션을 관리함</li>
  <li>서비스 계층에서 트랜잭션 시작시</li>
  <li><code>transactionManager.getTransaction()</code>을 호출</li>
  <li>매니저가 <code>DataSource</code>로 부터 커넥션을 얻음</li>
  <li>해당 커넥션을 트랜잭션 동기화 매니저(<code>TransactionSynchronizationManager</code>)에 보관</li>
  <li>커넥션은 [[ThreadLocal]]을 통하여 현재 스레드에 저장됨</li>
  <li>이후, Repo나 DAO 계층에선 <code>DataSource</code>에서 커넥션을 얻는게 아닌 <code>DataSrourceUtils.getConnection(dataSource)</code>를 사용하여 트랜잭션 동기화 매니저에 보관된 커넥션을 조회</li>
  <li>트랜잭션 종료 시, 매니저가 커밋이나 롤백을 수행하고 커넥션을 정리한다.</li>
  <li>이 상황에서도 <code>DataSourceUtils.releaseConnection()</code>을 사용하여 커넥션을 반납</li>
</ul>
<p>> 또한 <strong>트랜잭션 매니저, <code>DataSrouceUtils</code>를 통해 커넥션의 일관성과 트랜잭션의 경계를 보장</strong>한다.</p>
<h1>Spring에서의 DataSource</h1>
<p>--- Spring에선 Bean으로 등록하여 주입 후 사용한다.</p>
<pre><code class="language-yml">spring:
	datasource:
		url: jdbc:mysql://localhost:3306/mydb
		username: root
		password: pass
		driver-class-name: com.mysql.cj.jdbc.Driver
</code></pre>
<p>| 사용 위치                      | 설명                 | | -------------------------- | ------------------ | | JdbcTemplate, JPA, MyBatis | DB 작업을 위한 커넥션제공    | | PlatformTransactionManager | 트랜잭션 수행 시 커넥션 주입   | | Spring Batch               | 배치 메타정보 I/O 작업에 사용 | 아래는 설정파일에서 사용하는 datasource 관련 내용(참고용)</p>
<h1>Spring Batch에서 DataSource</h1>
<p>--- <code>DafaultBatchConfiguration</code>에선 <code>DataSource</code>를 이용하여 <strong>배치 실행 상태 정보를 저장</strong>한다.</p>
<h2>사용 위치</h2>
<p>| 사용 위치         | 역할                           | | ------------- | ---------------------------- | | JobRepository | JobInstance, JobExecution 저장 | | JobExplorer   | 실행 기록 조회                     | | JobLauncher   | Job 실행 시 메타정보 저장             | | StepExecution | Step의 사태저장                   |</p>
      </article>
    </main>

    <!-- @include partials/site-footer.html -->
  </body>
</html>
